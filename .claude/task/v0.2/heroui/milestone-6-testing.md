# Milestone 6: 测试与验证

## 📋 里程碑概述

**优先级**：⭐⭐⭐ 高
**预计时间**：2 小时
**状态**：🔲 待开始
**依赖**：Milestone 1, 2, 3, 4, 5 (所有迁移完成)
**阻塞**：无

## 🎯 目标

全面测试迁移后的应用，验证所有功能正常、样式一致、性能提升。确保迁移没有引入任何破坏性变更，并达到预期的改进目标。

## ✅ 任务清单

### 1. 功能测试

#### 1.1 顶栏功能

- [ ] **选择项目按钮**
  - 点击打开项目选择器
  - 样式正确（primary 色）
  - hover 态正常

- [ ] **加载/保存按钮**
  - 点击触发对应功能
  - 按钮状态正确
  - 加载态显示 spinner

- [ ] **侧栏控制按钮**
  - 展开/收起侧边栏
  - 图标切换正确
  - 动画流畅

#### 1.2 项目选择器

- [ ] **项目列表显示**
  - 项目卡片正确渲染
  - 圆角为 8px
  - hover 态正常

- [ ] **新建项目**
  - 输入框正常输入
  - 圆角为 12px
  - 表单验证正确

- [ ] **选择项目**
  - 点击选择生效
  - 按钮样式正确

#### 1.3 聊天功能

- [ ] **消息列表**
  - 消息正确显示
  - 用户/AI 消息区分明显
  - 滚动流畅

- [ ] **输入框**
  - TextArea 正常输入
  - 圆角为 12px
  - 自动高度调整
  - placeholder 显示正确

- [ ] **发送按钮**
  - 点击发送消息
  - loading 态正确
  - 禁用态正确

- [ ] **工具调用卡片**
  - 正确显示工具调用
  - 样式完整

- [ ] **错误提示**
  - Alert 组件显示错误
  - 可以关闭
  - 颜色为 danger 色

#### 1.4 版本管理

- [ ] **WIP 指示器**
  - 显示当前 WIP 状态
  - 按钮样式正确

- [ ] **版本列表**
  - 版本卡片正确渲染
  - Disclosure 展开/收起正常
  - 操作按钮正常

- [ ] **创建版本**
  - 对话框打开
  - 表单输入正常
  - 验证正确
  - 提交成功

- [ ] **版本时间线**
  - 时间线正确显示
  - 交互正常

#### 1.5 设置功能

- [ ] **LLM 设置**
  - 所有输入框正常
  - 密码输入框类型正确
  - 保存设置成功

- [ ] **文件设置**
  - 路径显示正确
  - 只读输入框样式正确

- [ ] **系统提示词编辑**
  - TextArea 编辑正常
  - 保存成功

- [ ] **连接测试**
  - 按钮 loading 态正常
  - 测试结果显示

#### 1.6 Tab 导航

- [ ] **Tab 切换**
  - 点击切换内容
  - 激活态样式正确
  - 图标和文字显示完整

- [ ] **键盘导航**
  - 左右箭头切换 Tab
  - 内容正确切换

### 2. 样式一致性检查

#### 2.1 主题色验证

- [ ] **Primary 色应用**
  - 主要按钮使用 #3388BB
  - hover 态颜色正确
  - focus 态显示正确

- [ ] **其他状态色**
  - success: 绿色
  - warning: 黄色
  - danger: 红色
  - 对比度符合标准

#### 2.2 圆角系统验证

- [ ] **按钮圆角**
  - 标准按钮：8px
  - 小按钮：8px
  - 图标按钮：8px

- [ ] **输入框圆角**
  - Input: 12px
  - TextArea: 12px
  - 表单字段统一

- [ ] **卡片圆角**
  - Card: 8px
  - 项目卡片：8px
  - 版本卡片：8px

#### 2.3 间距系统验证

- [ ] **按钮间距**
  - 按钮组 gap 为 8px
  - 容器内边距统一

- [ ] **表单间距**
  - 字段间距为 16px
  - 标签与输入框间距合理

- [ ] **卡片间距**
  - 卡片列表间距为 8px 或 16px
  - 卡片内边距统一

#### 2.4 阴影验证

- [ ] **浅色模式阴影**
  - 卡片有轻微蓝色阴影
  - Popover 有中等阴影
  - 层级明确

- [ ] **深色模式阴影**
  - 阴影为 transparent
  - 无明显阴影效果

### 3. 深色模式测试

- [ ] **主题切换无闪烁**
  - 切换流畅
  - 无 FOUC

- [ ] **所有组件适配深色模式**
  - Button 颜色正确
  - Input 背景色正确
  - Card 背景色正确
  - 文字对比度足够

- [ ] **主题色在深色模式下正确**
  - Primary 色亮度适配
  - 可读性良好

### 4. 响应式布局测试

- [ ] **桌面端 (>1024px)**
  - 侧边栏正常显示
  - 布局不拥挤

- [ ] **平板端 (768px-1024px)**
  - 侧边栏宽度自适应
  - 按钮大小合适

- [ ] **移动端 (<768px)**
  - 侧边栏可隐藏
  - 按钮不重叠
  - 输入框宽度适配

### 5. 键盘导航与无障碍性

- [ ] **Tab 键导航**
  - 可以 Tab 到所有交互元素
  - 顺序合理
  - focus 态明显

- [ ] **Enter/Space 键操作**
  - 按钮可以键盘激活
  - 表单可以 Enter 提交

- [ ] **Escape 键**
  - 可以关闭对话框
  - 可以取消操作

- [ ] **屏幕阅读器**
  - 按钮有合适的 aria-label
  - 表单字段关联正确
  - 错误消息可读取

### 6. 性能对比测试

#### 6.1 CSS 文件大小

- [ ] **统计 CSS 总大小**

  ```bash
  du -sh app/styles/
  ```

  - 记录迁移前后对比

- [ ] **统计 CSS 文件数量**

  ```bash
  find app/styles -name "*.css" | wc -l
  ```

  - 目标：24 → 14 个

- [ ] **统计 CSS 总行数**

  ```bash
  find app/styles -name "*.css" | xargs wc -l
  ```

  - 目标：~2800 → ~1500 行

#### 6.2 页面加载性能

- [ ] **使用 Chrome DevTools Network**
  - CSS 加载时间对比
  - 总资源大小对比

- [ ] **使用 Chrome Lighthouse**
  - Performance 评分
  - Best Practices 评分
  - Accessibility 评分

- [ ] **CSS Coverage**
  - 未使用 CSS 百分比
  - 优化空间分析

#### 6.3 运行时性能

- [ ] **按钮点击响应时间**
  - 无明显延迟
  - < 100ms 响应

- [ ] **输入框输入延迟**
  - 无输入卡顿
  - 实时响应

- [ ] **主题切换速度**
  - 切换流畅
  - < 200ms

### 7. 代码质量检查

- [ ] **无 console 错误**
  - 打开所有页面检查
  - 无 React 警告
  - 无 CSS 警告

- [ ] **无 TypeScript 错误**

  ```bash
  pnpm tsc --noEmit
  ```

- [ ] **Lint 通过**

  ```bash
  pnpm lint
  ```

- [ ] **代码格式化**
  ```bash
  pnpm format
  ```

### 8. 回归测试

- [ ] **创建新项目**
  - 完整流程测试
  - 数据保存正确

- [ ] **加载已有项目**
  - 项目正确加载
  - 文件路径正确

- [ ] **编辑 DrawIO 文件**
  - 编辑器正常工作
  - 保存成功

- [ ] **AI 聊天对话**
  - 发送消息成功
  - 流式响应正常
  - 工具调用正常

- [ ] **版本管理完整流程**
  - 保存快照成功
  - 创建版本成功
  - 加载版本成功
  - 删除版本成功

## 📝 测试检查表模板

### 功能测试报告

| 功能模块   | 测试项        | 状态    | 问题描述 |
| ---------- | ------------- | ------- | -------- |
| 顶栏       | 选择项目按钮  | ✅ / ❌ | -        |
| 顶栏       | 加载/保存按钮 | ✅ / ❌ | -        |
| 项目选择器 | 项目列表      | ✅ / ❌ | -        |
| 项目选择器 | 新建项目      | ✅ / ❌ | -        |
| 聊天       | 消息显示      | ✅ / ❌ | -        |
| 聊天       | 输入框        | ✅ / ❌ | -        |
| 聊天       | 发送消息      | ✅ / ❌ | -        |
| 版本管理   | WIP 指示器    | ✅ / ❌ | -        |
| 版本管理   | 版本列表      | ✅ / ❌ | -        |
| 版本管理   | 创建版本      | ✅ / ❌ | -        |
| 设置       | LLM 设置      | ✅ / ❌ | -        |
| 设置       | 系统提示词    | ✅ / ❌ | -        |

### 性能对比报告

| 指标            | 迁移前 | 迁移后 | 改进 |
| --------------- | ------ | ------ | ---- |
| CSS 文件数量    | 24     | -      | -    |
| CSS 总行数      | ~2800  | -      | -    |
| CSS 文件大小    | -      | -      | -    |
| !important 次数 | 多处   | -      | -    |
| 硬编码颜色      | 多处   | -      | -    |
| 页面加载时间    | -      | -      | -    |
| Lighthouse 评分 | -      | -      | -    |

## 🧪 浏览器兼容性测试

- [ ] **Chrome (最新版)**
  - 功能正常
  - 样式正确

- [ ] **Firefox (最新版)**
  - 功能正常
  - 样式正确

- [ ] **Safari (最新版，如有 Mac）**
  - 功能正常
  - 样式正确

- [ ] **Edge (最新版)**
  - 功能正常
  - 样式正确

## 📚 参考资源

- [Chrome DevTools Performance](https://developer.chrome.com/docs/devtools/performance/)
- [Lighthouse](https://developers.google.com/web/tools/lighthouse)
- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [Web Accessibility Evaluation Tools](https://www.w3.org/WAI/test-evaluate/tools/)

## ⚠️ 常见问题与解决

### 问题 1：样式加载延迟

- **现象**：页面加载时出现无样式内容
- **原因**：CSS 文件加载顺序问题
- **解决**：检查 globals.css 导入顺序

### 问题 2：主题色未生效

- **现象**：按钮颜色不是 #3388BB
- **原因**：主题配置未正确加载
- **解决**：检查 data-theme 属性和主题文件

### 问题 3：圆角不一致

- **现象**：部分组件圆角不是预期值
- **原因**：组件未设置 radius prop
- **解决**：显式设置 radius="lg"

### 问题 4：深色模式样式错误

- **现象**：深色模式下颜色对比度不够
- **原因**：深色模式变量未配置
- **解决**：检查 [data-theme="drawio2go-dark"]

### 问题 5：按钮点击无响应

- **现象**：Button 点击不触发
- **原因**：使用了 onClick 而非 onPress
- **解决**：替换为 onPress

## 🔗 相关里程碑

- **依赖**：
  - Milestone 1-5: 所有迁移工作

- **后续**：
  - 根据测试结果进行修复
  - 更新文档
  - 发布新版本

## 📝 完成标准

- [x] 所有功能测试通过
- [x] 所有样式一致性检查通过
- [x] 深色模式正常
- [x] 响应式布局正常
- [x] 无障碍性测试通过
- [x] 性能目标达成（CSS 减少 40%+）
- [x] 无 console 错误
- [x] 跨浏览器兼容
- [x] 测试报告已记录

## 📊 测试完成后行动

- [ ] **记录测试结果**
  - 填写功能测试报告
  - 填写性能对比报告
  - 截图保存

- [ ] **修复发现的问题**
  - 创建 Issue 跟踪
  - 优先级排序
  - 逐个修复

- [ ] **更新文档**
  - 更新 README 进度
  - 记录已知问题
  - 更新变更日志

- [ ] **准备发布**
  - 创建发布分支
  - 编写发布说明
  - 通知团队

---

**创建日期**：2025-11-14
**预计开始**：所有迁移里程碑完成后
**实际开始**：-
**完成日期**：-

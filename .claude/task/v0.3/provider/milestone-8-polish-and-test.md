# Milestone 8: 样式优化与测试

## 目标

优化UI样式，确保符合Material Design规范和HeroUI v3最佳实践，完成完整的功能测试，更新文档。

## 优先级

🟢 **中优先级** - 质量保证和完善

## 任务列表

### 1. 样式优化

**文件**: 多个样式文件

#### 设置面板样式

- [ ] 更新 `app/styles/components/settings.css`
  - 供应商Accordion样式
  - 模型Card样式
  - 表单字段间距和对齐
  - 按钮组布局
- [ ] 优化供应商折叠列表
  - Header高度和内边距
  - Content内边距和布局
  - 展开/折叠动画流畅
- [ ] 优化模型卡片
  - 卡片间距（8px gap）
  - 内边距（16px）
  - 圆角（8px，使用 var(--radius)）
  - 阴影（使用 var(--shadow-2)）

#### 模型选择器样式

- [ ] 优化 `app/styles/components/model-selector.css`
  - Trigger按钮样式细节
  - 玻璃形态效果增强
  - hover和focus状态
  - 下拉列表样式
  - 分组标题样式
  - 模型选项样式

#### Material Design规范检查

- [ ] 圆角：4px (小) / 8px (标准) / 12px (大)
- [ ] 间距：4px 基准（4/8/16/24/32px）
- [ ] 阴影：4层阴影系统（shadow-1 ~ shadow-4）
- [ ] 动画：150ms (快) / 200ms (标准) / 300ms (慢)

#### 主题适配

- [ ] 验证深色主题下所有UI元素
  - 文字颜色对比度
  - 边框颜色可见性
  - 背景颜色协调性
- [ ] 验证浅色主题下所有UI元素
- [ ] 玻璃形态效果在两种主题下都正常

### 2. 功能测试

#### 供应商管理测试

- [ ] 添加供应商
  - 输入所有字段
  - 保存成功
  - 列表中显示
- [ ] 编辑供应商
  - 修改各字段
  - 保存成功
  - 更改正确显示
- [ ] 删除供应商
  - 非活动供应商：直接删除
  - 活动供应商：显示确认，切换后删除
  - 最后一个供应商：提示不能删除（或允许但警告）
- [ ] 连接测试器功能（如果集成）

#### 模型管理测试

- [ ] 添加模型
  - 输入所有字段
  - 温度Slider拖动
  - 工具轮次Slider拖动（包括999）
  - 保存成功
- [ ] 编辑模型
  - 修改各字段
  - 保存成功
  - 更改正确显示
- [ ] 删除模型
  - 非活动模型：直接删除
  - 活动模型：显示确认，切换后删除
  - 最后一个模型：提示不能删除（或允许但警告）
- [ ] 设置默认模型
  - 选择一个模型设为默认
  - 原默认模型标记移除
  - 新默认模型显示标记

#### Agent设置测试

- [ ] 加载系统提示词
  - 首次访问显示默认值
  - 有保存值时显示保存的值
- [ ] 编辑系统提示词
  - TextArea正常输入
  - 变更检测生效
- [ ] 保存系统提示词
  - 保存成功
  - 下次加载显示保存的值
- [ ] 恢复默认提示词
  - 显示确认对话框
  - 确认后恢复为默认值
  - 变更检测生效

#### 模型选择器测试

- [ ] 显示当前模型
  - 正确显示模型名称
  - 正确显示供应商名称
- [ ] 打开下拉列表
  - 点击Trigger正确打开
  - 按供应商分组显示
  - 所有模型都显示
  - 默认模型有标记
  - 当前模型有选中指示器
- [ ] 切换模型
  - 选择不同模型
  - Trigger显示更新
  - 持久化到存储
  - 继续当前会话
- [ ] 发送消息
  - 使用新模型发送
  - 消息元数据记录正确

#### API集成测试

- [ ] 不同供应商类型
  - openai-compatible
  - deepseek
  - openai-reasoning
- [ ] 不同参数
  - 温度：0, 0.5, 1, 2
  - 工具轮次：5, 10, 30, 999
- [ ] 系统提示词
  - 使用全局系统提示词
  - 修改系统提示词后生效
- [ ] 错误处理
  - 供应商不存在返回404
  - 模型不存在返回404
  - 缺少参数返回400

#### 边界情况测试

- [ ] 无供应商
  - UI显示空状态
  - 提示添加供应商
- [ ] 无模型
  - UI显示空状态
  - 提示添加模型
- [ ] 删除当前活动供应商
  - 显示确认对话框
  - 切换到其他供应商的模型
- [ ] 删除当前活动模型
  - 显示确认对话框
  - 切换到同供应商的其他模型
- [ ] 存储操作超时
  - 显示错误提示
  - 不影响应用稳定性

### 3. TypeScript和Lint检查

- [ ] 运行 `pnpm tsc --noEmit`
  - 修复所有类型错误
  - 确保类型定义完整
- [ ] 运行 `pnpm run lint`
  - 修复所有ESLint错误
  - 修复所有ESLint警告（如合理）
- [ ] 检查未使用的导入和变量
- [ ] 检查console.log是否应该移除

### 4. 可访问性测试

- [ ] 键盘导航
  - Tab键可以访问所有交互元素
  - Enter/Space可以激活按钮和选项
  - Escape可以关闭对话框和下拉菜单
  - Arrow键可以在列表中导航
- [ ] 屏幕阅读器
  - 所有表单字段有Label
  - 图标按钮有aria-label
  - 状态变更有反馈
- [ ] 颜色对比
  - 文本与背景对比度 ≥ 4.5:1
  - 大文本对比度 ≥ 3:1
  - 使用在线工具检查

### 5. 性能测试

- [ ] 存储操作性能
  - 加载供应商列表 < 1秒
  - 保存配置 < 1秒
  - 切换模型 < 500ms
- [ ] UI渲染性能
  - 大量供应商/模型时（10+供应商，50+模型）
  - Accordion展开/折叠流畅
  - 下拉列表滚动流畅
- [ ] 模型选择器
  - 打开下拉列表 < 200ms
  - 选择模型响应 < 100ms

### 6. 文档更新

#### 更新AGENTS.md

- [ ] 添加LLM配置系统重构说明
  - 新的架构（供应商-模型分层）
  - 存储键结构
  - Agent设置独立
- [ ] 更新代码腐化清理记录
  - 记录此次重构的日期和主要变更
  - 记录影响的文件数量
- [ ] 更新常见问题（如有新的）

#### 更新app/types/AGENTS.md

- [ ] 添加新类型定义说明
  - ProviderConfig
  - ModelConfig
  - AgentSettings
  - ActiveModelReference
  - RuntimeLLMConfig
- [ ] 说明旧类型的废弃
  - LLMConfig已删除

#### 更新app/hooks/AGENTS.md（如果存在）

- [ ] 更新useStorageSettings文档
  - 新增的供应商/模型管理方法
  - 删除的旧方法

### 7. 清理和优化

- [ ] 删除未使用的代码
  - 旧的LLMConfig相关代码
  - 未引用的辅助函数
- [ ] 删除调试日志（保留必要的生产日志）
- [ ] 优化导入语句
  - 移除未使用的导入
  - 按字母顺序排列（如符合项目规范）
- [ ] 添加必要的注释
  - 复杂逻辑添加说明注释
  - 公共API添加JSDoc注释

## 涉及文件

- 📝 修改：`app/styles/components/settings.css`
- 📝 修改：`app/styles/components/model-selector.css`
- 📝 修改：`AGENTS.md`
- 📝 修改：`app/types/AGENTS.md`
- 📝 修改：`app/hooks/AGENTS.md`（如果存在）
- 📖 测试：所有新建和修改的组件

## 验收标准

### 样式
- [ ] 所有UI符合Material Design规范
- [ ] 深色/浅色主题完美适配
- [ ] 动画流畅自然
- [ ] 圆角、间距、阴影使用CSS变量

### 功能
- [ ] 所有用户流程可以正常完成
- [ ] 所有边界情况正确处理
- [ ] 错误提示清晰有用
- [ ] 数据持久化可靠

### 代码质量
- [ ] TypeScript编译无错误
- [ ] ESLint检查无错误
- [ ] 无未使用的代码
- [ ] 关键逻辑有注释

### 可访问性
- [ ] WCAG 2.1 AA级别合规
- [ ] 键盘可以完整操作
- [ ] 屏幕阅读器可以正常使用

### 性能
- [ ] 存储操作快速响应
- [ ] UI渲染流畅
- [ ] 大数据量时性能可接受

### 文档
- [ ] AGENTS.md更新完整
- [ ] 类型定义有文档
- [ ] 重大变更有记录

## 依赖关系

**前置依赖**:
- ✅ Milestone 1-7（所有功能实现完成）

**后续依赖**:
- 无，这是最后一个里程碑

## 注意事项

1. **完整性测试**: 测试所有功能点，不遗漏任何用户流程
2. **边界情况**: 特别注意删除操作的级联处理
3. **性能**: 大量数据时的性能表现很重要
4. **可访问性**: 这是用户体验的重要组成部分，不能忽视
5. **文档**: 良好的文档有助于未来的维护和扩展
6. **代码质量**: 清理和优化代码，为未来打好基础

## 预计时间

⏱️ **3-4 小时**

---

## 重构完成标志

当所有上述任务完成且验收标准满足时，LLM配置系统重构即宣告完成。新系统将提供：

✅ 灵活的供应商-模型分层架构
✅ 独立的Agent设置管理
✅ 模型独立的参数配置
✅ 便捷的右下角模型选择器
✅ 完整的HeroUI v3最佳实践
✅ 优秀的用户体验和可访问性

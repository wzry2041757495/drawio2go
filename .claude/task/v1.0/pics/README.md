# 图片对话功能 - 里程碑概览

## 项目目标

为DrawIO2Go对话系统添加图片支持，允许用户在对话中发送图片给AI模型。

## 设计决策

- ✅ 图片通过Base64编码传递给AI
- ✅ 支持点击/拖拽/粘贴三种上传方式
- ✅ 仅存储原图（使用deflate-raw压缩）
- ✅ 单张图片限制5MB
- ✅ 支持格式：PNG/JPEG/GIF/WebP
- ✅ 为后续文件对话功能预留扩展性

## 里程碑顺序

### Milestone 1: 数据库设计与迁移 (必须)

**预计时间**: 3-4小时
**状态**: 待开始

创建attachments表和存储层基础设施。这是所有后续工作的基础。

**输出**:

- attachments表在SQLite和IndexedDB中创建
- 存储层接口扩展完成

---

### Milestone 2: 图片处理工具层 (必须)

**预计时间**: 1小时
**状态**: 待开始

创建图片验证、压缩、转换工具。

**输出**:

- image-utils.ts工具库
- ImagePart类型定义
- 图片验证和转换功能

---

### Milestone 3: API集成 (必须)

**预计时间**: 2小时
**状态**: 待开始

修改聊天API以支持图片消息。

**输出**:

- Chat API支持接收和存储图片
- 图片正确传递给AI模型
- attachment转换工具

---

### Milestone 4: 前端上传组件 (重要)

**预计时间**: 4-5小时
**状态**: 待开始

实现三种上传方式的用户界面。

**输出**:

- 上传按钮组件
- 拖拽上传组件
- 粘贴上传功能
- 图片预览界面

---

### Milestone 5: 前端展示组件 (重要)

**预计时间**: 2-3小时
**状态**: 待开始

实现消息中图片的显示。

**输出**:

- ImageContent展示组件
- MessageContent集成
- 图片样式
- 加载和错误状态

---

### Milestone 6: 测试与优化 (重要)

**预计时间**: 2-3小时
**状态**: 待开始

全面测试和性能优化。

**输出**:

- 完整的测试清单
- 性能优化（懒加载等）
- 错误处理完善
- 用户体验优化

---

## 总体进度

- **总预计时间**: 13-17小时
- **当前进度**: 0/6 里程碑完成
- **整体状态**: 规划阶段

## 依赖关系

```
Milestone 1 (数据库)
    ↓
Milestone 2 (工具层)
    ↓
Milestone 3 (API)
    ↓
Milestone 4 (上传) + Milestone 5 (展示)
    ↓
Milestone 6 (测试优化)
```

## 验收标准

- ✅ 用户可以通过三种方式上传图片
- ✅ 图片正确显示在消息列表中
- ✅ AI能够识别并回复图片内容
- ✅ 图片正确存储在数据库中
- ✅ 删除对话时图片一并删除
- ✅ 5MB大小限制生效
- ✅ Electron和Web环境都正常工作
- ✅ 现有功能不受影响
- ✅ 为文件对话预留了扩展接口

## 后续扩展

该设计为未来功能预留了空间：

- 文件对话（type='file'）
- 音频对话（type='audio'）
- 视频对话（type='video'）
- 附件复用和批量管理

## 技术风险

1. **IndexedDB配额限制** - 浏览器通常50-100MB
2. **Base64体积膨胀** - 增大约33%
3. **AI模型兼容性** - 不是所有模型都支持vision

解决方案详见各里程碑文档。

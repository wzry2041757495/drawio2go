# Milestone 6: 测试与优化

## 目标

全面测试图片对话功能，优化性能，完善错误处理和用户体验。

## 范围

### 功能测试

- 三种上传方式（点击/拖拽/粘贴）
- 文件验证（大小/类型限制）
- 纯文本/纯图片/图文混合消息
- 多图片消息
- 历史消息中的图片显示
- 级联删除测试

### 跨平台测试

- Web环境（Chrome/Firefox/Safari）
- Electron环境
- 移动端响应式
- 不同屏幕尺寸

### 性能优化

- 图片懒加载实现
- Object URL内存管理验证
- 长对话滚动性能
- 存储空间使用监控
- 配额接近时的警告机制

### 错误处理完善

- 文件过大提示优化
- 文件类型不支持提示
- 上传失败重试机制
- 图片损坏时的降级显示
- 网络错误处理

### 用户体验优化

- 上传进度反馈
- 拖拽视觉效果优化
- 加载状态动画
- 图片预览交互优化
- 国际化文案检查

### 代码质量

- TypeScript类型检查
- 清理console.log
- 代码格式化
- 注释完善

### 验收标准

- [ ] 所有上传方式正常工作
- [ ] 5MB限制生效且提示清晰
- [ ] AI能识别并正确回复图片
- [ ] 两个环境（Web/Electron）都正常
- [ ] 删除对话时图片一并删除
- [ ] 长对话中图片懒加载工作
- [ ] 没有内存泄漏
- [ ] 错误情况有友好提示
- [ ] 存储配额监控工作正常
- [ ] 现有纯文本功能不受影响

## 关键文件

- `/home/aaa/Code/drawio2go/app/hooks/use-chat.ts` (修改)
- `/home/aaa/Code/drawio2go/app/components/chat/ChatSidebar.tsx` (完善)
- 所有前面里程碑涉及的文件（优化）

## 依赖

- 所有前置里程碑（1-5）

## 测试清单

### 基础功能

- [ ] 点击上传图片
- [ ] 拖拽上传图片
- [ ] 粘贴上传图片
- [ ] 发送纯图片消息
- [ ] 发送图文混合消息
- [ ] 发送多张图片
- [ ] 查看历史消息中的图片

### 边界测试

- [ ] 上传5MB临界值图片
- [ ] 上传超过5MB图片（应拒绝）
- [ ] 上传不支持格式（应拒绝）
- [ ] 发送到不支持vision的模型（应提示）
- [ ] 网络断开时的行为
- [ ] 存储配额不足时的行为

### 性能测试

- [ ] 发送10张图片的消息
- [ ] 滚动包含100张图片的长对话
- [ ] 快速连续上传多张图片
- [ ] 查看内存使用情况

### 兼容性测试

- [ ] Chrome浏览器
- [ ] Firefox浏览器
- [ ] Electron桌面端
- [ ] 移动端屏幕

## 监控指标

- 单张图片平均上传时间
- 图片渲染延迟
- 内存使用量
- 存储空间使用量
- 错误率

## 优化目标

- 图片上传响应时间 < 500ms
- 图片渲染延迟 < 200ms
- 无内存泄漏
- 存储使用有清晰可见的监控

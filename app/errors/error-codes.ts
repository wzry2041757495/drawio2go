/**
 * 错误码定义 - 4 位数字格式
 *
 * 错误码范围分配：
 * - 1000-1999: 通用错误
 * - 2000-2999: 存储层错误
 * - 3000-3999: API/网络错误
 * - 4000-4999: 版本管理错误
 * - 5000-5999: 表单验证错误
 * - 6000-6999: DrawIO XML 操作错误
 */
export const ErrorCodes = {
  // 1000-1999: 通用错误
  UNKNOWN_ERROR: 1000,
  NETWORK_ERROR: 1001,
  PERMISSION_DENIED: 1002,
  TIMEOUT: 1003,

  // 2000-2999: 存储层错误
  STORAGE_INVALID_PAGE_COUNT: 2001,
  STORAGE_INVALID_PAGE_NAMES: 2002,
  STORAGE_PAGE_NAME_NOT_STRING: 2003,
  STORAGE_SVG_TOO_LARGE: 2004,
  STORAGE_INVALID_SVG: 2005,
  STORAGE_PROJECT_NOT_FOUND: 2010,
  STORAGE_TIMEOUT: 2020,

  // 3000-3999: API/聊天错误
  CHAT_MISSING_PARAMS: 3001,
  CHAT_INVALID_CONFIG: 3002,
  CHAT_SEND_FAILED: 3003,
  CHAT_STREAM_ERROR: 3004,
  CHAT_TIMEOUT_ERROR: 3005,
  CHAT_REQUEST_CANCELLED: 3006,
  CHAT_API_KEY_INVALID: 3010,
  CHAT_MODEL_NOT_FOUND: 3011,
  CHAT_CONVERSATION_FORBIDDEN: 3012,
  CHAT_VISION_NOT_SUPPORTED: 3013,
  CHAT_INVALID_IMAGE: 3014,

  // 4000-4999: 版本管理错误
  VERSION_RESTORE_FAILED: 4001,
  VERSION_EXPORT_FAILED: 4002,
  VERSION_PARENT_NOT_FOUND: 4003,
  VERSION_INVALID_NUMBER: 4004,
  VERSION_EXISTS: 4005,
  VERSION_DELETE_WIP_FAILED: 4006,
  VERSION_NO_DIFF_DATA: 4007,
  VERSION_DIFF_INTEGRITY_ERROR: 4010,
  VERSION_SOURCE_LOAD_FAILED: 4011,
  VERSION_CROSS_PROJECT_ERROR: 4012,
  VERSION_WIP_NOT_FOUND: 4020,
  VERSION_CALCULATION_FAILED: 4021,
  VERSION_PARSE_FAILED: 4022,
  VERSION_NUMBER_EMPTY: 4030,
  VERSION_FORMAT_INVALID: 4031,
  VERSION_RESERVED: 4032,
  VERSION_SUB_INVALID: 4033,
  VERSION_SUB_RANGE: 4034,
  VERSION_CACHE_INVALID: 4040,
  VERSION_CROSS_PROJECT_ROLLBACK: 4041,

  // 5000-5999: 表单验证错误
  VALIDATION_PROJECT_NAME_REQUIRED: 5001,
  VALIDATION_PROJECT_NAME_MIN: 5002,
  VALIDATION_PROJECT_NAME_MAX: 5003,
  VALIDATION_PROJECT_DESC_MAX: 5004,
  VALIDATION_VERSION_NUMBER_REQUIRED: 5010,
  VALIDATION_VERSION_FORMAT: 5011,
  VALIDATION_VERSION_RESERVED: 5012,
  VALIDATION_VERSION_SUB_INVALID: 5013,
  VALIDATION_VERSION_SUB_RANGE: 5014,
  VALIDATION_VERSION_DESC_MAX: 5015,
  VALIDATION_LLM_API_KEY_REQUIRED: 5020,
  VALIDATION_LLM_BASE_URL_INVALID: 5021,
  VALIDATION_LLM_MODEL_REQUIRED: 5022,
  VALIDATION_LLM_TEMPERATURE_RANGE: 5023,

  // 6000-6999: DrawIO XML 操作错误
  XML_PAYLOAD_EMPTY: 6001,
  XML_DECODE_FAILED: 6002,
  XML_INVALID_FORMAT: 6003,
  XML_DECOMPRESS_FAILED: 6004,
  XML_ENV_NOT_SUPPORTED: 6005,
  XML_XPATH_VALIDATION_FAILED: 6010,
  XML_OPERATION_UNKNOWN: 6011,
  XML_BATCH_EDIT_FAILED: 6012,
} as const satisfies Record<string, number>;

export type ErrorCodeKey = keyof typeof ErrorCodes;
export type ErrorCode = (typeof ErrorCodes)[ErrorCodeKey];

const ERROR_CODE_ENTRIES = Object.entries(ErrorCodes) as Array<
  [ErrorCodeKey, ErrorCode]
>;

/**
 * 错误码到 i18n 键值的映射
 */
export function getErrorI18nKey(code: ErrorCode): string {
  const entry = ERROR_CODE_ENTRIES.find(([, value]) => value === code);
  if (!entry) return "common.unknownError";

  const [key] = entry;
  // 转换为小驼峰格式用于 i18n key
  return key
    .split("_")
    .map((part, index) =>
      index === 0
        ? part.toLowerCase()
        : part.charAt(0) + part.slice(1).toLowerCase(),
    )
    .join("");
}
